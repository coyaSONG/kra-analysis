name: Code Quality Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  # Python ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ (Ruff/Black)
  python-quality:
    name: Python Code Quality
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install quality tools (ruff/black)
        run: |
          python -m pip install --upgrade pip
          pip install ruff black

      - name: Ruff - ë¦°íŠ¸ ê²€ì‚¬ (ê²Œì´íŠ¸)
        run: |
          echo "ğŸ” Ruff ê²€ì‚¬(ê²Œì´íŠ¸) ì¤‘..."
          # ìë™ìˆ˜ì •ì´ í•„ìš”í•œ ë³€ê²½ì ì„ diffë¡œ ì¶œë ¥í•˜ê³ , ë°œê²¬ ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬
          ruff check . --diff --exit-non-zero-on-fix
          # ë¹„ìˆ˜ì • ê°€ëŠ¥ ìœ„ë°˜ê¹Œì§€ ê²Œì´íŠ¸
          ruff check .

      - name: Black - ì½”ë“œ í¬ë§· ê²€ì‚¬
        run: |
          echo "ğŸ¨ Black ì½”ë“œ í¬ë§· ê²€ì‚¬ ì¤‘..."
          black --check --diff packages/scripts
        continue-on-error: true

  # JavaScript ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ (pnpm ì›Œí¬ìŠ¤í˜ì´ìŠ¤)
  javascript-quality:
    name: JavaScript Code Quality
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Get pnpm store directory
        shell: bash
        run: |
          STORE_PATH=$(pnpm store path --silent)
          echo "STORE_PATH=$STORE_PATH" >> $GITHUB_ENV
          mkdir -p "$STORE_PATH"

      - name: Setup pnpm cache
        uses: actions/cache@v4
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml', '**/package.json') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: Install workspace dependencies
        run: pnpm install --no-frozen-lockfile

      - name: Run workspace lint
        run: pnpm -w run lint || true

  # ì½”ë“œ í’ˆì§ˆ ìš”ì•½ ë¦¬í¬íŠ¸
  quality-summary:
    name: Code Quality Summary
    needs: [python-quality, javascript-quality]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: í’ˆì§ˆ ê²€ì‚¬ ìš”ì•½
        run: |
          echo "ğŸ“Š ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"
          echo ""
          echo "ë‹¤ìŒ ë‹¨ê³„:"
          echo "1. ìœ„ì˜ ê²€ì‚¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”"
          echo "2. ì½”ë“œ ìŠ¤íƒ€ì¼ ìë™ ìˆ˜ì •ì„ ì›í•˜ë©´ ë¡œì»¬ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:"
          echo "   - Python: black packages/scripts && ruff check --fix packages/scripts"
          echo "   - Node: pnpm -w run lint"
          echo ""
          echo "ğŸ’¡ ì„¤ì •ì€ pyproject.toml ë° ê° íŒ¨í‚¤ì§€ì˜ ESLint ì„¤ì •ì„ ì°¸ê³ í•˜ì„¸ìš”."
