name: Code Quality Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  # Python ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
  python-quality:
    name: Python Code Quality
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install Python quality tools
        run: |
          python -m pip install --upgrade pip
          pip install black flake8 isort pylint

      - name: Black - ì½”ë“œ í¬ë§· ê²€ì‚¬
        run: |
          echo "ğŸ¨ Black ì½”ë“œ í¬ë§· ê²€ì‚¬ ì¤‘..."
          black --check --diff scripts/
        continue-on-error: true

      - name: isort - import ì •ë ¬ ê²€ì‚¬
        run: |
          echo "ğŸ“¦ Import ì •ë ¬ ê²€ì‚¬ ì¤‘..."
          isort --check-only --diff scripts/
        continue-on-error: true

      - name: Flake8 - ë¦°íŠ¸ ê²€ì‚¬
        run: |
          echo "ğŸ” Flake8 ë¦°íŠ¸ ê²€ì‚¬ ì¤‘..."
          flake8 scripts/ --count --select=E9,F63,F7,F82 --show-source --statistics
          flake8 scripts/ --count --exit-zero --max-complexity=10 --max-line-length=120 --statistics
        continue-on-error: true

      - name: Pylint - ê³ ê¸‰ ë¦°íŠ¸ ê²€ì‚¬
        run: |
          echo "ğŸ”¬ Pylint ê²€ì‚¬ ì¤‘..."
          pylint scripts/**/*.py --exit-zero --reports=y
        continue-on-error: true

  # JavaScript ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
  javascript-quality:
    name: JavaScript Code Quality
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'  # 23.6ì€ GitHub Actionsì—ì„œ ë¯¸ì§€ì›, LTS ë²„ì „ ì‚¬ìš©

      - name: Install JavaScript quality tools
        run: |
          npm install -g eslint prettier eslint-config-standard eslint-plugin-import eslint-plugin-n eslint-plugin-promise

      - name: ESLint - ë¦°íŠ¸ ê²€ì‚¬
        run: |
          echo "ğŸ” ESLint ê²€ì‚¬ ì¤‘..."
          # .eslintrcê°€ ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰
          eslint scripts/**/*.js --no-eslintrc --env node --env es6 || true
        continue-on-error: true

      - name: Prettier - ì½”ë“œ í¬ë§· ê²€ì‚¬
        run: |
          echo "ğŸ¨ Prettier í¬ë§· ê²€ì‚¬ ì¤‘..."
          npx prettier --check "scripts/**/*.js" || true
        continue-on-error: true

  # ì½”ë“œ í’ˆì§ˆ ìš”ì•½ ë¦¬í¬íŠ¸
  quality-summary:
    name: Code Quality Summary
    needs: [python-quality, javascript-quality]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: í’ˆì§ˆ ê²€ì‚¬ ìš”ì•½
        run: |
          echo "ğŸ“Š ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"
          echo ""
          echo "ë‹¤ìŒ ë‹¨ê³„:"
          echo "1. ìœ„ì˜ ê²€ì‚¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”"
          echo "2. ì½”ë“œ ìŠ¤íƒ€ì¼ ìë™ ìˆ˜ì •ì„ ì›í•˜ë©´ ë¡œì»¬ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:"
          echo "   - Python: black scripts/ && isort scripts/"
          echo "   - JavaScript: prettier --write scripts/**/*.js"
          echo ""
          echo "ğŸ’¡ íŒ: ì„¤ì • íŒŒì¼ì„ ì¶”ê°€í•˜ì—¬ í”„ë¡œì íŠ¸ ìŠ¤íƒ€ì¼ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:"
          echo "   - Python: .flake8, .pylintrc, pyproject.toml"
          echo "   - JavaScript: .eslintrc.json, .prettierrc"