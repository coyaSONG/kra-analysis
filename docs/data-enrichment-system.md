# ë°ì´í„° ë³´ê°• ì‹œìŠ¤í…œ (Data Enrichment System)

## ğŸ“‹ ê°œìš”

KRA ê²½ë§ˆ ì˜ˆì¸¡ ì‹œìŠ¤í…œì˜ ë°ì´í„° ë³´ê°• ëª¨ë“ˆì€ ê¸°ë³¸ ê²½ì£¼ ë°ì´í„°(API214_1)ì— ë§, ê¸°ìˆ˜, ì¡°êµì‚¬ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¶”ê°€í•˜ì—¬ ë” í’ë¶€í•œ ì˜ˆì¸¡ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°

### 1. API êµ¬ì„±
- **ê¸°ë³¸ ë°ì´í„°**: API214_1 (ê²½ì£¼ ìƒì„¸ ê²°ê³¼)
- **ë³´ê°• ë°ì´í„°**:
  - API8_2: ê²½ì£¼ë§ˆ ìƒì„¸ì •ë³´ (í˜ˆí†µ, ì„±ì )
  - API12_1: ê¸°ìˆ˜ ì •ë³´ (ê²½ë ¥, ì„±ì )
  - API19_1: ì¡°êµì‚¬ ì •ë³´ (ì„±ì , ìŠ¹ë¥ )

### 2. íŒŒì¼ êµ¬ì¡°
```
scripts/race_collector/
â”œâ”€â”€ collect_and_preprocess.js    # ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘
â”œâ”€â”€ api_clients.js               # API í´ë¼ì´ì–¸íŠ¸ ë° ìºì‹±
â”œâ”€â”€ enrich_race_data.js          # ë°ì´í„° ë³´ê°• ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ README.md                    # ëª¨ë“ˆ ë¬¸ì„œ

data/
â”œâ”€â”€ races/                       # ê²½ì£¼ ë°ì´í„°
â”‚   â””â”€â”€ YYYY/MM/YYYYMMDD/venue/
â”‚       â”œâ”€â”€ *_prerace.json      # ê¸°ë³¸ ë°ì´í„°
â”‚       â””â”€â”€ *_enriched.json     # ë³´ê°•ëœ ë°ì´í„°
â””â”€â”€ cache/                       # API ìºì‹œ
    â”œâ”€â”€ horses/                  # ë§ ì •ë³´ ìºì‹œ
    â”œâ”€â”€ jockeys/                 # ê¸°ìˆ˜ ì •ë³´ ìºì‹œ
    â””â”€â”€ trainers/                # ì¡°êµì‚¬ ì •ë³´ ìºì‹œ
```

## ğŸ’¡ í•µì‹¬ ê¸°ëŠ¥

### 1. ìºì‹± ì‹œìŠ¤í…œ
- **ìœ íš¨ê¸°ê°„**: 7ì¼
- **ì €ì¥ ìœ„ì¹˜**: `data/cache/`
- **íš¨ê³¼**: 
  - ì¤‘ë³µ API í˜¸ì¶œ ë°©ì§€
  - ì‘ë‹µ ì†ë„ í–¥ìƒ
  - API ì œí•œ íšŒí”¼

### 2. ìŠ¤ë§ˆíŠ¸ ë°ì´í„° ìˆ˜ì§‘
- ê³ ìœ í•œ ê¸°ìˆ˜/ì¡°êµì‚¬ë§Œ ì¡°íšŒ
- ìºì‹œ ìš°ì„  í™•ì¸
- API í˜¸ì¶œ ê°„ ë”œë ˆì´ (500ms)

### 3. ë°ì´í„° ë³´ê°• ë‚´ìš©

#### ğŸ ë§ ìƒì„¸ ì •ë³´ (hrDetail)
```json
{
  "faHrName": "ë¶€ë§ˆ ì´ë¦„",
  "moHrName": "ëª¨ë§ˆ ì´ë¦„",
  "rcCntT": 15,        // í†µì‚° ì¶œì „
  "ord1CntT": 3,       // í†µì‚° 1ì°©
  "ord2CntT": 2,       // í†µì‚° 2ì°©
  "winRateT": "20.0",  // í†µì‚° ìŠ¹ë¥ 
  "winRateY": "25.0",  // ì˜¬í•´ ìŠ¹ë¥ 
  "chaksunT": 50000000,// í†µì‚° ìƒê¸ˆ
  "hrLastAmt": "ê±°ë˜ê°€ ì •ë³´"
}
```

#### ğŸ‡ ê¸°ìˆ˜ ìƒì„¸ ì •ë³´ (jkDetail)
```json
{
  "age": 35,
  "birthday": "19890101",
  "debut": "20100505",
  "ord1CntT": 968,     // í†µì‚° 1ì°©
  "rcCntT": 6254,      // í†µì‚° ì¶œì „
  "winRateT": "15.5",  // í†µì‚° ìŠ¹ë¥ 
  "winRateY": "14.2"   // ì˜¬í•´ ìŠ¹ë¥ 
}
```

#### ğŸ‘¨â€ğŸ« ì¡°êµì‚¬ ìƒì„¸ ì •ë³´ (trDetail)
```json
{
  "meet": "ì„œìš¸",
  "stDate": 20050601,
  "ord1CntT": 323,     // í†µì‚° 1ì°©
  "rcCntT": 2684,      // í†µì‚° ì¶œì „
  "winRateT": 12.0,    // í†µì‚° ìŠ¹ë¥ 
  "plcRateT": 35.0,    // í†µì‚° ë³µìŠ¹ë¥ 
  "winRateY": 6.3      // ì˜¬í•´ ìŠ¹ë¥ 
}
```

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ë‹¨ì¼ ê²½ì£¼ ë³´ê°•
```bash
node scripts/race_collector/enrich_race_data.js data/races/2025/06/20250608/seoul/race_1_20250608_1_prerace.json
```

### 2. ë‚ ì§œë³„ ì „ì²´ ë³´ê°•
```bash
node scripts/race_collector/enrich_race_data.js 20250608 1
# 20250608: ë‚ ì§œ
# 1: ê²½ë§ˆì¥ ì½”ë“œ (1=ì„œìš¸, 2=ì œì£¼, 3=ë¶€ì‚°)
```

### 3. ì›Œí¬í”Œë¡œìš°
```
1. collect_and_preprocess.jsë¡œ ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘
   â†“
2. enrich_race_data.jsë¡œ ìƒì„¸ ì •ë³´ ì¶”ê°€
   â†“
3. _enriched.json íŒŒì¼ ìƒì„±
```

## ğŸ“Š ì„±ëŠ¥ ë° ì œí•œì‚¬í•­

### API í˜¸ì¶œ ìµœì í™”
- **ìºì‹± íš¨ê³¼**: ì²« ì‹¤í–‰ ì‹œ 100% API í˜¸ì¶œ â†’ ì¬ì‹¤í–‰ ì‹œ 90% ì´ìƒ ìºì‹œ ì‚¬ìš©
- **ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 
  - ì²« ì‹¤í–‰: ê²½ì£¼ë‹¹ ì•½ 30-60ì´ˆ
  - ì¬ì‹¤í–‰: ê²½ì£¼ë‹¹ ì•½ 5-10ì´ˆ

### API ì œí•œ ëŒ€ì‘
- í˜¸ì¶œ ê°„ 500ms ë”œë ˆì´
- ì‹¤íŒ¨ ì‹œ null ë°˜í™˜ (ë¶€ë¶„ ì‹¤íŒ¨ í—ˆìš©)
- ì¼ì¼ í˜¸ì¶œ í•œë„ ê³ ë ¤ í•„ìš”

## ğŸ” ë°ì´í„° í™œìš© ì˜ˆì‹œ

### 1. í˜ˆí†µ ê¸°ë°˜ ë¶„ì„
```javascript
// ë¶€ëª¨ë§ˆì˜ ì„±ì ì´ ì¢‹ì€ ë§ ì°¾ê¸°
const goodBloodline = horses.filter(h => 
  h.hrDetail && h.hrDetail.faHrName.includes("ìœ ëª…í•œë¶€ë§ˆ")
);
```

### 2. ê¸°ìˆ˜-ë§ ì¡°í•© ë¶„ì„
```javascript
// ìŠ¹ë¥  ë†’ì€ ê¸°ìˆ˜ê°€ íƒ„ ì‹ ë§ˆ
const promising = horses.filter(h => 
  h.hrDetail && h.hrDetail.rcCntT <= 3 &&  // ì‹ ë§ˆ
  h.jkDetail && parseFloat(h.jkDetail.winRateT) > 15  // ìŠ¹ë¥  15% ì´ìƒ ê¸°ìˆ˜
);
```

### 3. ì¡°êµì‚¬ ìµœê·¼ í¼ ë¶„ì„
```javascript
// ì˜¬í•´ ì„±ì ì´ ì¢‹ì€ ì¡°êµì‚¬ì˜ ë§
const hotTrainer = horses.filter(h =>
  h.trDetail && h.trDetail.winRateY > h.trDetail.winRateT  // ì˜¬í•´ê°€ í‰ê· ë³´ë‹¤ ì¢‹ìŒ
);
```

## ğŸ› ï¸ ìœ ì§€ë³´ìˆ˜

### ìºì‹œ ê´€ë¦¬
```bash
# ìºì‹œ ì „ì²´ ì‚­ì œ (ê°•ì œ ìƒˆë¡œê³ ì¹¨)
rm -rf data/cache/*

# íŠ¹ì • íƒ€ì…ë§Œ ì‚­ì œ
rm -rf data/cache/horses/*
```

### ì—ëŸ¬ ì²˜ë¦¬
- API ì‘ë‹µ ì˜¤ë¥˜ ì‹œ í•´ë‹¹ ë°ì´í„°ë§Œ null
- ì „ì²´ í”„ë¡œì„¸ìŠ¤ëŠ” ê³„ì† ì§„í–‰
- ë¡œê·¸ì— ì‹¤íŒ¨ ë‚´ì—­ í‘œì‹œ

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ
- [í”„ë¡œì íŠ¸ ê°œìš”](project-overview.md)
- [ë°ì´í„° êµ¬ì¡°](data-structure.md)
- [API ë¶„ì„](api-analysis.md)
- [í”„ë¡¬í”„íŠ¸ ê°œë°œ ì „ëµ](prompt-development-strategy.md)